!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).WxappEnhance={})}(this,(function(t){"use strict";function e(t,e,n,r){return new(n||(n=Promise))((function(o,i){function c(t){try{a(r.next(t))}catch(t){i(t)}}function u(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,u)}a((r=r.apply(t,e||[])).next())}))}function n(t,e){return t===e||t!=t&&e!=e}function r(t,e){for(var r=t.length;r--;)if(n(t[r][0],e))return r;return-1}var o=Array.prototype.splice;function i(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}i.prototype.clear=function(){this.__data__=[],this.size=0},i.prototype.delete=function(t){var e=this.__data__,n=r(e,t);return!(n<0)&&(n==e.length-1?e.pop():o.call(e,n,1),--this.size,!0)},i.prototype.get=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]},i.prototype.has=function(t){return r(this.__data__,t)>-1},i.prototype.set=function(t,e){var n=this.__data__,o=r(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this};var c="object"==typeof global&&global&&global.Object===Object&&global,u="object"==typeof self&&self&&self.Object===Object&&self,a=c||u||Function("return this")(),s=a.Symbol,f=Object.prototype,l=f.hasOwnProperty,h=f.toString,d=s?s.toStringTag:void 0;var p=Object.prototype.toString;var v=s?s.toStringTag:void 0;function y(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":v&&v in Object(t)?function(t){var e=l.call(t,d),n=t[d];try{t[d]=void 0;var r=!0}catch(t){}var o=h.call(t);return r&&(e?t[d]=n:delete t[d]),o}(t):function(t){return p.call(t)}(t)}function b(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function g(t){if(!b(t))return!1;var e=y(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var j,_=a["__core-js_shared__"],w=(j=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"";var m=Function.prototype.toString;function O(t){if(null!=t){try{return m.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var A=/^\[object .+?Constructor\]$/,S=Function.prototype,E=Object.prototype,R=S.toString,x=E.hasOwnProperty,T=RegExp("^"+R.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function k(t){return!(!b(t)||(e=t,w&&w in e))&&(g(t)?T:A).test(O(t));var e}function C(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return k(n)?n:void 0}var B=C(a,"Map"),P=C(Object,"create");var I=Object.prototype.hasOwnProperty;var z=Object.prototype.hasOwnProperty;function M(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function $(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function U(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}M.prototype.clear=function(){this.__data__=P?P(null):{},this.size=0},M.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},M.prototype.get=function(t){var e=this.__data__;if(P){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return I.call(e,t)?e[t]:void 0},M.prototype.has=function(t){var e=this.__data__;return P?void 0!==e[t]:z.call(e,t)},M.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=P&&void 0===e?"__lodash_hash_undefined__":e,this},U.prototype.clear=function(){this.size=0,this.__data__={hash:new M,map:new(B||i),string:new M}},U.prototype.delete=function(t){var e=$(this,t).delete(t);return this.size-=e?1:0,e},U.prototype.get=function(t){return $(this,t).get(t)},U.prototype.has=function(t){return $(this,t).has(t)},U.prototype.set=function(t,e){var n=$(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function F(t){var e=this.__data__=new i(t);this.size=e.size}F.prototype.clear=function(){this.__data__=new i,this.size=0},F.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},F.prototype.get=function(t){return this.__data__.get(t)},F.prototype.has=function(t){return this.__data__.has(t)},F.prototype.set=function(t,e){var n=this.__data__;if(n instanceof i){var r=n.__data__;if(!B||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new U(r)}return n.set(t,e),this.size=n.size,this};var L=function(){try{var t=C(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function D(t,e,n){"__proto__"==e&&L?L(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var N=Object.prototype.hasOwnProperty;function H(t,e,r){var o=t[e];N.call(t,e)&&n(o,r)&&(void 0!==r||e in t)||D(t,e,r)}function W(t,e,n,r){var o=!n;n||(n={});for(var i=-1,c=e.length;++i<c;){var u=e[i],a=r?r(n[u],t[u],u,n,t):void 0;void 0===a&&(a=t[u]),o?D(n,u,a):H(n,u,a)}return n}function q(t){return null!=t&&"object"==typeof t}function V(t){return q(t)&&"[object Arguments]"==y(t)}var G=Object.prototype,J=G.hasOwnProperty,K=G.propertyIsEnumerable,Q=V(function(){return arguments}())?V:function(t){return q(t)&&J.call(t,"callee")&&!K.call(t,"callee")},X=Array.isArray;var Y="object"==typeof t&&t&&!t.nodeType&&t,Z=Y&&"object"==typeof module&&module&&!module.nodeType&&module,tt=Z&&Z.exports===Y?a.Buffer:void 0,et=(tt?tt.isBuffer:void 0)||function(){return!1},nt=/^(?:0|[1-9]\d*)$/;function rt(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&nt.test(t))&&t>-1&&t%1==0&&t<e}function ot(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var it={};function ct(t){return function(e){return t(e)}}it["[object Float32Array]"]=it["[object Float64Array]"]=it["[object Int8Array]"]=it["[object Int16Array]"]=it["[object Int32Array]"]=it["[object Uint8Array]"]=it["[object Uint8ClampedArray]"]=it["[object Uint16Array]"]=it["[object Uint32Array]"]=!0,it["[object Arguments]"]=it["[object Array]"]=it["[object ArrayBuffer]"]=it["[object Boolean]"]=it["[object DataView]"]=it["[object Date]"]=it["[object Error]"]=it["[object Function]"]=it["[object Map]"]=it["[object Number]"]=it["[object Object]"]=it["[object RegExp]"]=it["[object Set]"]=it["[object String]"]=it["[object WeakMap]"]=!1;var ut="object"==typeof t&&t&&!t.nodeType&&t,at=ut&&"object"==typeof module&&module&&!module.nodeType&&module,st=at&&at.exports===ut&&c.process,ft=function(){try{var t=at&&at.require&&at.require("util").types;return t||st&&st.binding&&st.binding("util")}catch(t){}}(),lt=ft&&ft.isTypedArray,ht=lt?ct(lt):function(t){return q(t)&&ot(t.length)&&!!it[y(t)]},dt=Object.prototype.hasOwnProperty;function pt(t,e){var n=X(t),r=!n&&Q(t),o=!n&&!r&&et(t),i=!n&&!r&&!o&&ht(t),c=n||r||o||i,u=c?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],a=u.length;for(var s in t)!e&&!dt.call(t,s)||c&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||rt(s,a))||u.push(s);return u}var vt=Object.prototype;function yt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||vt)}function bt(t,e){return function(n){return t(e(n))}}var gt=bt(Object.keys,Object),jt=Object.prototype.hasOwnProperty;function _t(t){return null!=t&&ot(t.length)&&!g(t)}function wt(t){return _t(t)?pt(t):function(t){if(!yt(t))return gt(t);var e=[];for(var n in Object(t))jt.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}var mt=Object.prototype.hasOwnProperty;function Ot(t){if(!b(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=yt(t),n=[];for(var r in t)("constructor"!=r||!e&&mt.call(t,r))&&n.push(r);return n}function At(t){return _t(t)?pt(t,!0):Ot(t)}var St="object"==typeof t&&t&&!t.nodeType&&t,Et=St&&"object"==typeof module&&module&&!module.nodeType&&module,Rt=Et&&Et.exports===St?a.Buffer:void 0,xt=Rt?Rt.allocUnsafe:void 0;function Tt(t,e){if(e)return t.slice();var n=t.length,r=xt?xt(n):new t.constructor(n);return t.copy(r),r}function kt(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}function Ct(){return[]}var Bt=Object.prototype.propertyIsEnumerable,Pt=Object.getOwnPropertySymbols,It=Pt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var c=t[n];e(c,n,t)&&(i[o++]=c)}return i}(Pt(t),(function(e){return Bt.call(t,e)})))}:Ct;function zt(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}var Mt=bt(Object.getPrototypeOf,Object),$t=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)zt(e,It(t)),t=Mt(t);return e}:Ct;function Ut(t,e,n){var r=e(t);return X(t)?r:zt(r,n(t))}function Ft(t){return Ut(t,wt,It)}function Lt(t){return Ut(t,At,$t)}var Dt=C(a,"DataView"),Nt=C(a,"Promise"),Ht=C(a,"Set"),Wt=C(a,"WeakMap"),qt="[object Map]",Vt="[object Promise]",Gt="[object Set]",Jt="[object WeakMap]",Kt="[object DataView]",Qt=O(Dt),Xt=O(B),Yt=O(Nt),Zt=O(Ht),te=O(Wt),ee=y;(Dt&&ee(new Dt(new ArrayBuffer(1)))!=Kt||B&&ee(new B)!=qt||Nt&&ee(Nt.resolve())!=Vt||Ht&&ee(new Ht)!=Gt||Wt&&ee(new Wt)!=Jt)&&(ee=function(t){var e=y(t),n="[object Object]"==e?t.constructor:void 0,r=n?O(n):"";if(r)switch(r){case Qt:return Kt;case Xt:return qt;case Yt:return Vt;case Zt:return Gt;case te:return Jt}return e});var ne=ee,re=Object.prototype.hasOwnProperty;var oe=a.Uint8Array;function ie(t){var e=new t.constructor(t.byteLength);return new oe(e).set(new oe(t)),e}var ce=/\w*$/;var ue=s?s.prototype:void 0,ae=ue?ue.valueOf:void 0;function se(t,e){var n=e?ie(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function fe(t,e,n){var r,o,i,c=t.constructor;switch(e){case"[object ArrayBuffer]":return ie(t);case"[object Boolean]":case"[object Date]":return new c(+t);case"[object DataView]":return function(t,e){var n=e?ie(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return se(t,n);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(t);case"[object RegExp]":return(i=new(o=t).constructor(o.source,ce.exec(o))).lastIndex=o.lastIndex,i;case"[object Symbol]":return r=t,ae?Object(ae.call(r)):{}}}var le=Object.create,he=function(){function t(){}return function(e){if(!b(e))return{};if(le)return le(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function de(t){return"function"!=typeof t.constructor||yt(t)?{}:he(Mt(t))}var pe=ft&&ft.isMap,ve=pe?ct(pe):function(t){return q(t)&&"[object Map]"==ne(t)};var ye=ft&&ft.isSet,be=ye?ct(ye):function(t){return q(t)&&"[object Set]"==ne(t)},ge="[object Arguments]",je="[object Function]",_e="[object Object]",we={};function me(t,e,n,r,o,i){var c,u=1&e,a=2&e,s=4&e;if(n&&(c=o?n(t,r,o,i):n(t)),void 0!==c)return c;if(!b(t))return t;var f=X(t);if(f){if(c=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&re.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!u)return kt(t,c)}else{var l=ne(t),h=l==je||"[object GeneratorFunction]"==l;if(et(t))return Tt(t,u);if(l==_e||l==ge||h&&!o){if(c=a||h?{}:de(t),!u)return a?function(t,e){return W(t,$t(t),e)}(t,function(t,e){return t&&W(e,At(e),t)}(c,t)):function(t,e){return W(t,It(t),e)}(t,function(t,e){return t&&W(e,wt(e),t)}(c,t))}else{if(!we[l])return o?t:{};c=fe(t,l,u)}}i||(i=new F);var d=i.get(t);if(d)return d;i.set(t,c),be(t)?t.forEach((function(r){c.add(me(r,e,n,r,t,i))})):ve(t)&&t.forEach((function(r,o){c.set(o,me(r,e,n,o,t,i))}));var p=f?void 0:(s?a?Lt:Ft:a?At:wt)(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(p||t,(function(r,o){p&&(r=t[o=r]),H(c,o,me(r,e,n,o,t,i))})),c}we[ge]=we["[object Array]"]=we["[object ArrayBuffer]"]=we["[object DataView]"]=we["[object Boolean]"]=we["[object Date]"]=we["[object Float32Array]"]=we["[object Float64Array]"]=we["[object Int8Array]"]=we["[object Int16Array]"]=we["[object Int32Array]"]=we["[object Map]"]=we["[object Number]"]=we[_e]=we["[object RegExp]"]=we["[object Set]"]=we["[object String]"]=we["[object Symbol]"]=we["[object Uint8Array]"]=we["[object Uint8ClampedArray]"]=we["[object Uint16Array]"]=we["[object Uint32Array]"]=!0,we["[object Error]"]=we[je]=we["[object WeakMap]"]=!1;function Oe(t){return me(t,5)}function Ae(t,e,r){(void 0!==r&&!n(t[e],r)||void 0===r&&!(e in t))&&D(t,e,r)}var Se,Ee=function(t,e,n){for(var r=-1,o=Object(t),i=n(t),c=i.length;c--;){var u=i[Se?c:++r];if(!1===e(o[u],u,o))break}return t};var Re=Function.prototype,xe=Object.prototype,Te=Re.toString,ke=xe.hasOwnProperty,Ce=Te.call(Object);function Be(t){if(!q(t)||"[object Object]"!=y(t))return!1;var e=Mt(t);if(null===e)return!0;var n=ke.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Te.call(n)==Ce}function Pe(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function Ie(t,e,n,r,o,i,c){var u=Pe(t,n),a=Pe(e,n),s=c.get(a);if(s)Ae(t,n,s);else{var f,l=i?i(u,a,n+"",t,e,c):void 0,h=void 0===l;if(h){var d=X(a),p=!d&&et(a),v=!d&&!p&&ht(a);l=a,d||p||v?X(u)?l=u:q(f=u)&&_t(f)?l=kt(u):p?(h=!1,l=Tt(a,!0)):v?(h=!1,l=se(a,!0)):l=[]:Be(a)||Q(a)?(l=u,Q(u)?l=function(t){return W(t,At(t))}(u):b(u)&&!g(u)||(l=de(a))):h=!1}h&&(c.set(a,l),o(l,a,r,i,c),c.delete(a)),Ae(t,n,l)}}function ze(t,e,n,r,o){t!==e&&Ee(e,(function(i,c){if(o||(o=new F),b(i))Ie(t,e,c,n,ze,r,o);else{var u=r?r(Pe(t,c),i,c+"",t,e,o):void 0;void 0===u&&(u=i),Ae(t,c,u)}}),At)}function Me(t){return t}function $e(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}var Ue=Math.max;function Fe(t,e,n){return e=Ue(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=Ue(r.length-e,0),c=Array(i);++o<i;)c[o]=r[e+o];o=-1;for(var u=Array(e+1);++o<e;)u[o]=r[o];return u[e]=n(c),$e(t,this,u)}}var Le=L?function(t,e){return L(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:Me,De=Date.now;var Ne,He,We,qe=(Ne=Le,He=0,We=0,function(){var t=De(),e=16-(t-We);if(We=t,e>0){if(++He>=800)return arguments[0]}else He=0;return Ne.apply(void 0,arguments)});var Ve,Ge=(Ve=function(t,e,n){ze(t,e,n)},function(t,e){return qe(Fe(t,e,Me),t+"")}((function(t,e){var r=-1,o=e.length,i=o>1?e[o-1]:void 0,c=o>2?e[2]:void 0;for(i=Ve.length>3&&"function"==typeof i?(o--,i):void 0,c&&function(t,e,r){if(!b(r))return!1;var o=typeof e;return!!("number"==o?_t(r)&&rt(e,r.length):"string"==o&&e in r)&&n(r[e],t)}(e[0],e[1],c)&&(i=o<3?void 0:i,o=1),t=Object(t);++r<o;){var u=e[r];u&&Ve(t,u,r,i)}return t})));function Je(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}function Ke(t){return"symbol"==typeof t||q(t)&&"[object Symbol]"==y(t)}var Qe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xe=/^\w*$/;function Ye(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var c=t.apply(this,r);return n.cache=i.set(o,c)||i,c};return n.cache=new(Ye.Cache||U),n}Ye.Cache=U;var Ze=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tn=/\\(\\)?/g,en=function(t){var e=Ye(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ze,(function(t,n,r,o){e.push(r?o.replace(tn,"$1"):n||t)})),e})),nn=s?s.prototype:void 0,rn=nn?nn.toString:void 0;function on(t){if("string"==typeof t)return t;if(X(t))return Je(t,on)+"";if(Ke(t))return rn?rn.call(t):"";var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e}function cn(t,e){return X(t)?t:function(t,e){if(X(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Ke(t))||Xe.test(t)||!Qe.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:en(function(t){return null==t?"":on(t)}(t))}function un(t){if("string"==typeof t||Ke(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e}function an(t,e){return e.length<2?t:function(t,e){for(var n=0,r=(e=cn(e,t)).length;null!=t&&n<r;)t=t[un(e[n++])];return n&&n==r?t:void 0}(t,function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}(e,0,-1))}function sn(t,e){return null==(t=an(t,e=cn(e,t)))||delete t[un((n=e,r=null==n?0:n.length,r?n[r-1]:void 0))];var n,r}function fn(t){return Be(t)?void 0:t}var ln=s?s.isConcatSpreadable:void 0;function hn(t){return X(t)||Q(t)||!!(ln&&t&&t[ln])}function dn(t,e,n,r,o){var i=-1,c=t.length;for(n||(n=hn),o||(o=[]);++i<c;){var u=t[i];e>0&&n(u)?e>1?dn(u,e-1,n,r,o):zt(o,u):r||(o[o.length]=u)}return o}function pn(t){return(null==t?0:t.length)?dn(t,1):[]}var vn=function(t){return qe(Fe(t,void 0,pn),t+"")}((function(t,e){var n={};if(null==t)return n;var r=!1;e=Je(e,(function(e){return e=cn(e,t),r||(r=e.length>1),e})),W(t,Lt(t),n),r&&(n=me(n,7,fn));for(var o=e.length;o--;)sn(n,e[o]);return n}));const yn=/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/;const bn=Array.isArray;function gn(t){return"function"==typeof t}function jn(){let t=[];function e(e){const n=t.filter((t=>t.id===e));return n.length?n[0]:void 0}function n(t){const n=e(t);if(n)return n;throw new Error("请求 "+t+" 不在任务列表中")}return{clear:function(){t=[]},abort:function(t){n(t).task.abort()},onChunkReceived:function(t,e){n(t).task.onChunkReceived(e)},offChunkReceived:function(t,e){n(t).task.offChunkReceived(e)},offHeadersReceived:function(t,e){n(t).task.offHeadersReceived(e)},onHeadersReceived:function(t,e){n(t).task.onHeadersReceived(e)},remove:function(e){t=t.filter((t=>t.id!==e))},generateTaskId:function({taskId:n,url:r}){const o=n||function(){const t=[],e="0123456789abcdef";for(var n=0;n<36;n++)t[n]=e.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=e.substr(3&Number(t[19])|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}();if(e(o))throw new Error("请求 "+r+"___"+o+" 在任务列表中已存在");if(10===t.length)throw new Error("请求 "+r+"___"+o+" 失败，已超出最大并发限制10");return o},add:function(e,n,r){t.push({id:n,task:e,option:r})},getList:function(){return t}}}const _n={baseUrl:"",method:"get",timeout:6e3,header:{"content-type":"application/json"}};var wn,mn;function On(t,e){return{type:t,payload:e}}!function(t){t.NavigateTo="navigateTo",t.RedirectTo="redirectTo",t.ReLaunch="reLaunch",t.SwitchTab="switchTab"}(wn||(wn={})),function(t){t.Push="push",t.ReLaunch="reLaunch",t.Redirect="redirect",t.Switch="switch"}(mn||(mn={}));const An={debug:!1};const Sn={creatStore:function(t,e){const n=Ge(Oe(An),e||{}),{rootState:r,reducers:o}=t.reduce(((t,e)=>(t.rootState[e.name]=e.getInitialState(),t.reducers=Object.assign(Object.assign(Object.assign({},t.reducers),e.caseReducers),e.extraReducers),t)),{rootState:{},reducers:{}});let i=[];function c(){return r}function u(t){let e=()=>null;if(gn(t)){const n=t({dispatch:u,getState:c});e=()=>n}else{const e=t.type.substring(0,t.type.indexOf("/")),c=Object.keys(r).sort();if(-1===c.indexOf(e))throw new Error(`[store] ${e} 无效，有效 module ${c}`);const u=o[t.type];if(u){n.debug&&(console.debug("prev sate",r),console.debug("action",t));const o=u(r[e],t);r[e]=Oe(o);i.filter((t=>-1!==t.modules.indexOf(e)&&t.show)).forEach((t=>{const n=a(t.selectors,e);t.self.setData(n)})),n.debug&&console.debug("next sate",r)}}return{unwrap:e}}function a(t,e=""){let n={};return t.filter((t=>!e||t[0]===e)).forEach((t=>{const e=r[t[0]],o=t[1];if(o)if(bn(o))o.forEach((t=>{n[t]=e[t]}));else{Object.keys(o).sort().forEach((t=>{const r=o[t];n[t]=gn(r)?r(e):e[r]}))}else n[t[0]]=e})),Oe(n)}function s(t,e){i.filter((e=>e.self===t))[0].show=e}return{dispatch:u,selector:function(...t){const e=t.map((t=>t[0])),n=e=>{const n=a(t);e.setData(n)};return Behavior({data:a(t),pageLifetimes:{show(){s(this,!0),n(this)},hide(){s(this,!1)}},lifetimes:{created(){!function(t,e,n,r=!1){i.push({modules:t,self:e,show:r,selectors:n})}(e,this,t,!0)},detached(){!function(t){i=i.filter((e=>e.self!==t))}(this)},attached(){n(this)}},methods:{dispatch:u}})},getState:c}},craeteAsyncAction:function(t,n){const r=t+"/fulfilled",o=t+"/rejected",i=t+"/pending";function c(t){return function(c){return e(this,void 0,void 0,(function*(){c.dispatch(On(i));try{const e=yield n(t,c);return c.dispatch(On(r,e)),e}catch(t){throw c.dispatch(On(o,t)),t}}))}}return c.pending=i,c.fulfilled=r,c.rejected=o,c},createModule:function(t){let e=t.initialState;"function"==typeof e&&(e=e());const n=t.name,r=t.reducers||{},o=Object.keys(r).sort().reduce(((t,e)=>{const o=n+"/"+e;return t.caseReducers[o]=r[e],t.actions[e]=t=>On(o,t),t}),{actions:{},caseReducers:{}}),i=o.actions,c=o.caseReducers,u=t.extraReducers||{};return{actions:i,name:n,reducer:{caseReducers:c,name:n,getInitialState:()=>Oe(e),extraReducers:u}}}};t.Wex=Sn,t.createEvent=function(t){let e=[];function n(n,r,o,i=0){if(!t.includes(n))throw new Error("[Event] $on | $once，试图监听无效事件："+n+"有效事件列表："+t);e.push({event:n,handler:r,triggerCount:0,self:o,limitCount:i})}return{$on:function(t,e,r){n(t,e,r)},$emit:function(n,r){if(!t.includes(n))throw new Error("[Event] $emit，试图触发无效事件："+n+"有效事件列表："+t);e.filter((t=>t.event===n)).forEach((t=>{t.triggerCount++,t.self?t.handler.call(t.self,r):t.handler(r)})),e=e.filter((t=>!(t.limitCount>0&&t.limitCount<=t.triggerCount)))},$off:function(t,n){e=e.filter((e=>!(e.event===t&&e.handler===n)))},$once:function(t,e,r){n(t,e,r,1)},getListens:function(){return e}}},t.createFetch=function(t){const n=Ge(Oe(_n),t||{}),r=jn();let o=function(t){return t},i=function(t){return t},c=function(t){return t};function u(t,u){return e(this,void 0,void 0,(function*(){try{let e=Ge(Oe(n),Object.assign({url:t},u||{}));e=yield o(vn(e,["baseUrl"]));const c=yield function(t){const e=Oe(t),o=r.generateTaskId(e);t.url=function(t){return yn.test(t)}(t.url)?t.url:n.baseUrl+t.url,t.method&&(t.method=t.method.toUpperCase());return new Promise(((n,i)=>{r.add(wx.request(Object.assign(Object.assign({},vn(t,["taskId"])),{fail(t){i(t)},success:t=>{n(t)},complete:()=>{r.remove(o)}})),o,e)}))}(e);return yield i(c)}catch(t){throw c(t)||t}}))}return u.onRequest=function(t){o=t},u.onResponse=function(t){i=t},u.onError=function(t){c=t},u.task=r,u},t.createRouter=function(){let t=!1,n=function(t){return t},r=function(t,e){return t},o=function(t,e){return t};function i(i){return e(this,void 0,void 0,(function*(){try{let e=Oe(i);if(t)throw new Error("[Router] navigate 失败，有页面未跳转完成");t=!0,e=yield n(e);let o=null;const c=e.query?e.path+"?"+function(t){const e=[];return Object.keys(t).forEach((n=>{t[n]&&e.push(n+"="+t[n])})),e.join("&")}(e.query):e.path;if(e.navigateType===wn.NavigateTo)o=yield wx.navigateTo({url:c,events:e.on||{}});else o=yield wx[e.navigateType]({url:c});if(o.eventChannel&&e.emit){const t=o.eventChannel;Object.keys(e.emit).sort().forEach((n=>{t.emit(n,e.emit)}))}const u=yield r(o,e);return t=!1,u}catch(e){throw t=!1,o(e,i)||e}}))}return{onAfterEach:function(t){r=t},onBeforeEach:function(t){n=t},onError:function(t){o=t},back:function(n=1){return e(this,void 0,void 0,(function*(){if(t)throw new Error("[Router] back 失败，有页面未跳转完成");t=!0;try{const e=yield wx.navigateBack({delta:n});return t=!1,e}catch(e){throw t=!1,o(e,"back")||e}}))},push:function(t){return e(this,void 0,void 0,(function*(){return yield i(Object.assign(Object.assign({},t),{navigateType:wn.NavigateTo,routerType:mn.Push}))}))},switchTab:function(t){return e(this,void 0,void 0,(function*(){return yield i(Object.assign(Object.assign({},t),{navigateType:wn.SwitchTab,routerType:mn.Switch}))}))},reLaunch:function(t){return e(this,void 0,void 0,(function*(){return yield i(Object.assign(Object.assign({},t),{navigateType:wn.ReLaunch,routerType:mn.ReLaunch}))}))},redirect:function(t){return e(this,void 0,void 0,(function*(){return yield i(Object.assign(Object.assign({},t),{navigateType:wn.RedirectTo,routerType:mn.Redirect}))}))}}},t.getNavRect=function(){const{statusBarHeight:t,system:e,windowWidth:n}=wx.getSystemInfoSync(),r={top:8,width:96,height:32,right:8};try{const e=wx.getMenuButtonBoundingClientRect?wx.getMenuButtonBoundingClientRect():null;if(!e)throw new Error("getMenuButtonBoundingClientRect Error");if(!e.width)throw new Error("getMenuButtonBoundingClientRect Error");r.top=e.top-t,r.width=e.width,r.height=e.height,r.right=n-e.right}catch(t){!!(e.toLowerCase().search("ios")+1)&&(r.top=4,r.width=88)}const o=2*r.top+r.height;return{height:t+o,capsuleBar:r,statusBarHeight:t,navBarHeight:o}},Object.defineProperty(t,"__esModule",{value:!0})}));
